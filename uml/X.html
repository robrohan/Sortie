<!--
	Copyright 2006 Rob Rohan
	You can use this under the GNU Lesser General Public License if you wish
	
	http://www.opensource.org/licenses/lgpl-license.php
-->
<html>
<head>
	<style type="text/css">
		body 
		{
			margin: 0px;
			background-color: transparent;
		}
		
		input
		{
			background: white;
			font-family: helvetica;
			font-size: 8pt;
		}
		
		.classItem
		{
			padding: 3px;
			position: absolute;
			background: #e4f6f6;
			font-family: helvetica;
			font-size: 8pt;
		}
		.wrapperClassItem
		{
			background-color: #d4ddff;
			padding-bottom: 5px;
			padding-left: 10px;
			padding-right: 10px;
		}
		
		#undostack
		{
			position: absolute;
			top: -100000;
			left: -100000;
		}
		
		#workarea
		{
			height: 100%;
			width: 100%;
			background-color: #e4f6f6;
		}
		
		#trash
		{
			height: 64px;
			width: 64px;
			background: url(delete.png);
			float: left;
		}
		
		#newclass
		{
			height: 64px;
			width: 64px;
			background: url(add.png);
			float: left;
		}
		
		#undo
		{
			height: 64px;
			width: 64px;
			background: url(undo.png);
			float: left;
		}
	</style>
	
	<link rel="stylesheet" type="text/css" href="niftyCorners.css">
	
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/util/Log.js"></script>
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/util/Collections.js"></script>
	
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/util/BrowserSniffer.js"></script>
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/ui/Mouse.js"></script>
	
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/ui/EventManager.js"></script>
		
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/xml/XmlSax.js"></script>
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/xml/XmlW3CDom.js"></script>
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/xml/XmlDocument.js"></script>
	
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/io/Gateway.js"></script>
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/io/RemoteObject.js"></script>
	
	<script type="text/javascript" language="javascript" src="http://thoth.robrohan.com/ajax/js/util/Output.js"></script>
	
	<script type="text/javascript" language="javascript" src="wz_jsgraphics.js"></script>
	<script type="text/javascript" language="javascript" src="nifty.js"></script>
	
	<script language="javascript" type="text/javascript">
		DEBUG = false;
		log.init();
		
		var shouldManipulate = false;
		var focusedItem = null;	
		var focusedLine = null;
		
		var linestartX = 0;
		var linestartY = 0;
		
		var startX = 0;
		var startY = 0;
		
		var zindexTrack = 10;
		
		var connectFromItem = null;
		
		//add a mouse listener
		neuro_addMoveListener(neuro_trackMouse);
		neuro_addMoveListener(function(e){
		    window.status = "X: " + SysMouse.X + " Y:" + SysMouse.Y;
		    if(focusedItem && shouldManipulate)
		    {
		    		if(e.shiftKey)
		    		{
		    			//the difference form where you started to where to moved to added to the
		    			//current size
		    			focusedItem.style.height = start_height + (SysMouse.Y - startY) + "px";
			    		focusedItem.style.width = start_width + (SysMouse.X - startX) + "px";
		    		}
		    		
		    		else
		    		{
		    			//the gap from the where they clicked to the top
			    		focusedItem.style.top = SysMouse.Y - top_to_click + "px";
			    		focusedItem.style.left = SysMouse.X - left_to_click + "px";
			    		
			    		if(focusedItem.from || focusedItem.to)
			    		{
			    			//jg.clear();
			    		}
		    		}
		    		
		    }
		});
		
		var top_to_click;
		var left_to_click;
		var start_width;
		var start_height;
		
		//add a mouse down event
		neuro_addMouseDownListener(function(e){
			 window.status += " Down " + e.target.nodeName + " Has To: " + e.target.to
			 + " Has From: " + e.target.from + " title: " + e.target.title;
			 
			 //alert(e.shiftKey);
			 if(e.target.nodeName == "DIV" && e.target.id == "workarea" && !e.altKey)
			 {
			 		
			 }
			 else if(e.target.nodeName == "DIV" && e.target.id.indexOf("C") == 0 && !e.altKey)
			 {
			 	startX = SysMouse.X;
			 	startY = SysMouse.Y;
			 	
			 	if(focusedItem)
			 	{	
				 	top_to_click = startY - parseInt(focusedItem.style.top.toString().replace(/px/,""));
				 	left_to_click = startX - parseInt(focusedItem.style.left.toString().replace(/px/,""));
				 	start_width = parseInt(focusedItem.style.width.toString().replace(/px/,""));
				 	start_height = parseInt(focusedItem.style.height.toString().replace(/px/,""));
				 	shouldManipulate = true;
			 	}
			 }
			 else if(
			 	(e.target.nodeName == "DIV" && e.target.id.indexOf("C") == 0 && e.altKey) &&
			 	(linestartX == 0 && linestartY == 0)
			 )
			 {
			 	linestartX = SysMouse.X;
				linestartY = SysMouse.Y;
				
				connectFromItem = e.target;
			 }
			 else if(
				(e.target.nodeName == "DIV" && e.target.id.indexOf("C") == 0 && e.altKey) &&
			 	(linestartX != 0 && linestartY != 0)
			 )
			 {
			 	var groupid = "LG" + new Date().getTime();
			 	
				//alert(jg)
				jg.setColor("green"); // red
				jg.setStroke(5);
				jg.drawLine(linestartX, linestartY, SysMouse.X, SysMouse.Y, groupid);
				jg.paint();
				
				if(connectFromItem != null)
				{
					connectFromItem.to = e.target;
					e.target.from = connectFromItem;
				}
				
				linestartX = 0;
				linestartY = 0;
			 }
			 else if(e.target.title && e.target.title.indexOf("LG") == 0)
			 {
			 	focusedLine = new Array();
			 	var alldiv = document.getElementsByTagName("DIV");
			 	var t = e.target.title;
			 	//this is going to be horrid slow :(
			 	for(var x=0; x<alldiv.length; x++)
			 	{
			 		if(alldiv.item(x).title == t)
			 		{
			 			focusedLine[focusedLine.length] = alldiv.item(x);
			 		}
			 	}
			 	focusedItem = null;
			 }
			 else
			 {
			 	window.status = e.target.nodeName + " :: " + e.target.id + " :: " + e.target.className;
			 }
			 
			 try
			 {
			 	focusedItem.style.zIndex = zindexTrack++;
			 	e.target.style.zIndex = zindexTrack++;
			 }
			 catch(e)
			 {
			 	//
			 } 
		});
		
		///////trash....
		neuro_addMouseUpListener(function(e){	
			if(e.target.id == "trash")
			{
				if(focusedItem)
				{
					focusedItem.style.position = "relative";
					document.getElementById("undostack").appendChild(focusedItem);
															
					focusedItem = null;
				} 
				if(focusedLine)
				{
					for(var z=0; z<focusedLine.length; z++)
					{
						document.getElementById("workarea").removeChild(focusedLine[z]);
					}
					focusedLine = null;
				}
					
			}
			shouldManipulate = false;
		});
		
		function onover_ShowSelected(item)
		{
			if(focusedItem && focusedItem != item)
				focusedItem.style.border = "2px solid transparent";

			//focusedItem = document.getElementById(item.id);
			focusedItem = item;
			//item.style.border = "2px solid #faf7f7";
		}
		
		function deselectAll()
		{
			if(focusedItem)
				focusedItem.style.border = "2px solid transparent";
			focusedItem = null;
		}
		
		function undo()
		{
			var stack = document.getElementById("undostack");
			var fc = stack.firstChild;
			
			if(fc)
			{
				fc.style.position = "absolute";
				document.getElementById("workarea").appendChild(fc);
			}
		}
		
		function newClass()
		{
			//add a new class
			var d = document.createElement("DIV");
			var myid = "C"+new Date().getTime();
			
			d.setAttribute("class","classItem");
			d.setAttribute("style","top: " + (SysMouse.Y + 100) + "; left: " + (SysMouse.X + 100) + "; width:130px; height: 110px;");
			//d.setAttribute("id",myid);
			//d.setAttribute("title",myid);
			d.setAttribute("onmouseover","onover_ShowSelected(this)");
			d.setAttribute("onmousemove","onover_ShowSelected(this)");
			
			var wrapper = document.createElement("DIV");
			wrapper.setAttribute("class","wrapperClassItem");
			wrapper.setAttribute("id",myid);
			wrapper.setAttribute("title",myid);
			
			var i = document.createElement("INPUT");
			i.setAttribute("type","text");
			i.setAttribute("style","width: 100%; text-align:center;");
			i.setAttribute("value","ClassName");
			
			wrapper.appendChild(i);
			
			wrapper.appendChild(document.createElement("hr"));
			
			///////////////////////////////////////////
			var s = document.createElement("SPAN");
			s.setAttribute("onclick","addClassItem(this.nextSibling,'Attribute')");
			s.setAttribute("title","Add an Attribute");
			s.innerHTML = "+";
			
			wrapper.appendChild(s);
						
			var attrs = document.createElement("DIV");
			attrs.setAttribute("class","wrapperClassItemAttribtues");
			attrs.appendChild(makeClassItem("Attribute"));
						
			wrapper.appendChild(attrs);
			wrapper.appendChild(document.createElement("hr"));
			///////////////////////////////////////////
			
			var s2 = document.createElement("SPAN");
			s2.setAttribute("onclick","addClassItem(this.nextSibling,'Method()')");
			s2.setAttribute("title","Add a Method");
			s2.innerHTML = "+";
			
			wrapper.appendChild(s2);
			
			var meths = document.createElement("DIV");
			meths.setAttribute("class","wrapperClassItemMethods");
			meths.appendChild(makeClassItem("Method()"));
			
			wrapper.appendChild(meths);

			d.appendChild(wrapper);

			document.getElementById("workarea").appendChild(d);
			
			Rounded("div.classItem","all","#f4f4f4","#d4ddff","border #000000");
		}
		
		function addClassItem(to,text)
		{
			to.appendChild(makeClassItem(text));
		}
		
		function makeClassItem(text)
		{
			var d = document.createElement("DIV");
			var i = document.createElement("INPUT");
			i.setAttribute("type","text");
			i.setAttribute("value",text)
			i.setAttribute("style","width: 90%; text-align:left;");
			
			var s = document.createElement("SPAN");
			s.setAttribute("onclick","removeClassItem(this.parentNode)");
			s.setAttribute("title","Remove this item");
			s.innerHTML = "&mdash;";
			
			d.appendChild(i);
			d.appendChild(s);
			
			return d;
		}
		
		function removeClassItem(item)
		{
			item.parentNode.removeChild(item);
		}
		
		var jg;
		function main()
		{
			if(!NiftyCheck()) 
				return;
			
			Rounded("div.classItem","all","#f4f4f4","#d4ddff","border #000000");
		}
	</script>
	
</head>
	<body onload="main();">
		<div id="toolbox">
			<div id="trash" title="Delete"></div>
			<div id="newclass" onclick="newClass()" title="New Class"></div>
			<div id="undo" onclick="undo()" title="Undo Class Delete"></div>
		</div>
		
		<div id="workarea" onclick="deselectAll()"></div>
		
		<div id="undostack"></div>
		
		<script language="javascript" type="text/javascript">
			jg = new jsGraphics("workarea");
		</script>
	</body>
</html>
